<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
<style>
  .block	{width:30px;
			 height:30px;
			 border:solid 0;
			 background-image:url('../imgs/block.jpg');
			 background-size: 30px 30px;}
  .flagBlock    {width:30px;
				 height:30px;
				 border:solid 0;
				 background-image:url('../imgs/flag.jpg');
				 background-size: 30px 30px;
				 }
  .qmarkBlock   {width:30px;
				 height:30px;
				 border:solid 0;
				 background-image:url('../imgs/qmark.jpg');
				 background-size: 30px 30px;}
  .oBlock0	{width:30px; height:30px; border:0px; }
  .oBlock1	{width:30px; height:30px; border:0px; color:blue}
  .oBlock2	{width:30px; height:30px; border:0px; color:green}
  .oBlock3	{width:30px; height:30px; border:0px; color:red}
  .oBlock4	{width:30px; height:30px; border:0px; color:purple}
  .oBlock5	{width:30px; height:30px; border:0px; color:#aa0021}
  .oBlock6	{width:30px; height:30px; border:0px; color:#aa0021}
  .oBlock7	{width:30px; height:30px; border:0px; color:#aa0021}
  .oBlock8	{width:30px; height:30px; border:0px; color:#aa0021}
  //버튼 초기화
</style>
 
 </head>
 <body>


<script>



//이 초기화 하는거도 나중에 함수 만들어서 인자 넣고 처리하기

//지뢰위치 테스트용 직접입력하기
var rowNum=10;
var colNum=10;
var setup=10;
//초기값 세팅

var mine=[];

for (var i=0;i<colNum; i++)
{
	mine[i] = [];
}

//지뢰 배열 초기화는 나중에 initial 함수 만들어서 인자 넣고 처리하기
for(var i=0; i<colNum; i++){
	for(var j=0; j<rowNum; j++){
		mine[i][j]=0;
	}
}

for(;;){
	var rnum1=parseInt(Math.random()*colNum);
	var rnum2=parseInt(Math.random()*rowNum);
	if(setup==0){
		break;
	}
	if(mine[rnum1][rnum2] != 9){
		mine[rnum1][rnum2] = 9; // 지뢰일때 값은 9로
		setup--;
	}
}



//--------------------------------------------주변에 지뢰가 몇개 있는지 계산하는 함수
function aroundMine(x, y){
	var count=0; // 리턴할 지뢰 갯수
	if(mine[x][y] != 9){ // 해당 칸이 지뢰면 갯수 셀 필요가 없으니 스킵. 아닐 경우에만 for문 시작
		for(var i=-1; i<2; i++){
			for(var j=-1; j<2; j++){
				if(x+i<0 || y+j<0 || x+i>(colNum-1) || y+j>(rowNum-1)){
					continue;
				}
				if(mine[x+i][y+j]==9){
					mine[x][y]++;
				}
			}
		}
	}
	return mine[x][y];
};
//--------------------------------------------지뢰갯수 확인함수 끝


//--------------------------------------------초기에 맵 그리는 함수
function draw_map(value, cols, rows){
	var mineMap = document.getElementById(value);
	var map = "";
	for(var j=0; j<rows; j++){
		for(var i=0; i<cols; i++){
			map += ("<input type='button' id=");
			map += (i+","+j+" onclick='leftClick(this.id)' onmousedown='rightClick(this.id)' oncontextmenu='return false' class='block'>");
			//버튼에다가 좌표값 주고 온클릭이벤트 넣기!
		}
		map+="<br>";
	}
	mineMap.innerHTML=map;
	return map;
}
//--------------------------------------------초기에 맵 그리는 함수 끝


//--------------------------------------------왼클릭 함수 시작
function leftClick(id){//id 들어오는 방식은 3,9 요런식이다. 앞에 3은 가로 몇번째인지, 뒤에 9는 세로 몇번째인지.
	var btn = document.getElementById(id)
	if(btn.className == 'block' || btn.className == 'qmarkBlock'){
	//아직 안눌린 버튼인가?
		var x=id.split(","); //좌표값을 떼온다. 
							 //만약 id = 3,9일경우 x[0]=3, x[1]=9 가 된다. 
		if(mine[x[0]][x[1]]==9){ // 값이 9면 지뢰다.
			alert("꽥!")
		}else{
			//alert(mine[x[0]][x[1]]);//테스트용
			//버튼 눌림 효과
			var att = document.createAttribute("class");
			att.value = "oBlock"+mine[x[0]][x[1]];
			document.getElementById(id).setAttributeNode(att);
			if(mine[x[0]][x[1]]==0){
				for(var i=-1; i<2; i++){
					for(var j=-1; j<2; j++){
						//짐 여기서 무한루프가 도는거 같다
						//어떻게할까...
						if((parseInt(x[0])+i)<0 || (parseInt(x[1])+j)<0 || (parseInt(x[0])+i)>(colNum-1) || (parseInt(x[1])+j)>(rowNum-1)){
							continue;	
						}
						if(document.getElementById((parseInt(x[0])+i)+","+(parseInt(x[1])+j)).className == 'block'
						   && mine[(parseInt(x[0])+i)][(parseInt(x[1])+j)] != 9){
							leftClick((parseInt(x[0])+i)+","+(parseInt(x[1])+j));
						}
					}
				}
			}else{
				//버튼 눌림 효과
				document.getElementById(id).value = mine[x[0]][x[1]]; // 주변 지뢰갯수 넣어주기
			}
		
		}
	}
}
//--------------------------------------------왼클릭 함수 끝

//--------------------------------------------우클릭 함수 시작
function rightClick(id){//id 들어오는 방식은 3,9 요런식이다. 앞에 3은 가로 몇번째인지, 뒤에 9는 세로 몇번째인지.
	var x=id.split(",");//좌표값을 떼온다. 
		                //만약 id = 3,9일경우 x[0]=3, x[1]=9 가 된다. 
	var btn = document.getElementById(id);
	if(event.button == 2){ // event.button == 2 조건은 '이 이벤트가 우클릭으로 발생헀는가'를 확인하는것.
	                      // 만약 event.button == 1이면 '왼클릭이니?' 임.
		//우클릭시
		if(btn.className == 'block'){
			btn.className = 'flagBlock';
		//열지 않은 블록인 경우 -> 깃발상태로
		}else if(btn.className == 'flagBlock'){
			btn.className = 'qmarkBlock';
		//깃발상태인 경우 -> 궁금표로
		}else if(btn.className == 'qmarkBlock'){
			btn.className = 'block';
		//궁금표상탱니 경우 -> 원상태로
		}
		//그리고 이미 깐 블럭인 경우는 그냥 if문 자체를 스킵
	}
//휠버튼 클릭시
	if (event.button == 4){

		var mineCnt = mine[x[0]][x[1]]; // 해당 블록 숫자 받아오기
		var flagCnt = 0; // 주변 깃발 갯수 세는거

		//일단 블록이 '숫자로 열린 상태'인것을 확인하고
		if(btn.className != 'block' || btn.className != 'flagBlock' || btn.className != 'qmarkBlock'){
			//이하 주변 깃발 갯수를 센다.
			for(var i=-1; i<2; i++){
				for(var j=-1; j<2; j++){
					if((parseInt(x[0])+i)<0 || (parseInt(x[1])+j)<0 || (parseInt(x[0])+i)>(colNum-1) || (parseInt(x[1])+j)>(rowNum-1)){
						continue;
					}
					if(document.getElementById((parseInt(x[0])+i)+","+(parseInt(x[1])+j)).className == 'flagBlock'){
						flagCnt++;					
					}
				}
			}
			//그리고 만약 해당 블록 숫자 = 깃발 갯수 라면
			if(mineCnt == flagCnt){
				//주변 모든 블록을 다 선택한다.
				for(var i=-1; i<2; i++){
					for(var j=-1; j<2; j++){
						if((parseInt(x[0])+i)<0 || (parseInt(x[1])+j)<0 || (parseInt(x[0])+i)>(colNum-1) || (parseInt(x[1])+j)>(rowNum-1)){
							continue;	
						}
						if(document.getElementById((parseInt(x[0])+i)+","+(parseInt(x[1])+j)).className == 'block'){
							leftClick((parseInt(x[0])+i)+","+(parseInt(x[1])+j));
							//그냥 왼클릭 여러개열기랑 다른점은
							//해당 블록이 지뢰여도 그냥 연다는 것.
						}
					}
				}
			}
		}

	}


}
//--------------------------------------------우클릭 함수 끝

function startGame(level){

	switch(level){
		case "lev1": // 초급
			rowNum=9;
			colNum=9;
			setup=10;
			break;
		case "lev2": // 중급
			rowNum=16;
			colNum=16;
			setup=40;
			break;
		case "lev3": // 고급
			rowNum=16;
			colNum=30;
			setup=99;
			break;
		default:
			rowNum=10;
			colNum=10;
			setup=10;
			break;
	}

	draw_map("mineMap", colNum, rowNum);
	for(var i=0; i<colNum; i++){
		for(var j=0; j<rowNum; j++){
			aroundMine(i,j);
		}
	}
}

/*
window.onload=function(){
	draw_map("mineMap", colNum, rowNum);
	for(var i=0; i<colNum; i++){
		for(var j=0; j<rowNum; j++){
			aroundMine(i,j);
		}
	}
}
*/

</script>
<Table border="1px solid" style="text-align:center;">
	<tr>
		<td><input type="button" id="lev1" value="초급" style="width:120px; height:40px" onclick="startGame(this.id);"></td>
		<td><input type="button" id="lev2" value="중급" style="width:120px; height:40px" onclick="startGame(this.id);"></td>
		<td><input type="button" id="lev3" value="고급" style="width:120px; height:40px" onclick="startGame(this.id);"></td>
	</tr>
	<tr>
		<td colspan="3"><div id="mineMap"></div></td>
	</tr>
	<tr>
		<td>지뢰 갯수</td>
		<td>진행 시간</td>
		<td>남은 블록 수</td>
	</tr>
	<tr>
		<td><span id="mineCntView"></span></td>
		<td></td>
		<td></td>
	</tr>
</table>

 </body>
</html>
